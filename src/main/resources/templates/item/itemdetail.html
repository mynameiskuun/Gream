<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <th:block th:replace="/main/config :: config"></th:block>
</head>
<body>
<!-- header start-->
<th:block th:replace="/main/header :: header"></th:block>
<!-- header end -->

    <div id="item-detail-wrapper">
        <div id="item-detail">
            <div id="item-img-box" th:style="'background-image: url('+ ${item.getThumbnailUrl()} + ');'">
            </div>
            <div id="item-information">
                <div class="detail-text-box">
                    <h1>[[${item.getName()}]]</h1>
                </div>
                <div class="detail-text-box" th:text="${#numbers.formatInteger(item.getPrice(), 3, 'COMMA') + '원'} ">
                </div>
                <div class="detail-text-box">
                    <h3>[[${item.getDetail()}]]</h3>
                </div>
                <div class="detail-text-box" id="itemStock">
                    잔여수량 : [[${item.getItemStock()}]]
                </div>
                <div style="display: flex">
                    <h3>주문 수량</h3>
                        <input type="number" name="orderQuantity" class="countBox" id="orderQuantity" style="width: 50px;" value="1" min="1"/>
                    <span><button id="orderBtn">주문하기</button></span>
                    <span><button onclick="cartBtn()">장바구니 추가</button></span>
                </div>
                <a><div id="usable-coupon-box">
                    <h3>사용가능한 쿠폰을 확인하세요</h3>
                </div></a>
            </div>
        </div>
        <div id="item-detail-content">
            아이템 세부 디테일 정보
            <span>
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Fuga maiores, quis minima incidunt voluptatibus error consectetur et reprehenderit. Repellendus laudantium voluptates ad doloremque neque dolore error dolorum soluta temporibus suscipit.
            </span>
        </div>
        <div id="item-review-box">

            <div id="item-detail-review-wrapper">
                <div id="buyer-satisfied-score-box" class="card text-center">
                    <div class="card-header">
          <span class="text-primary">99%</span
          ><span>의 구매자가 만족했어요</span>
                    </div>

                    <div class="card-body">
                        <div id="rating-container">
                            <div class="rating-score">
                                <div class="satisfied-level">매우 만족해요</div>
                                <div class="star-rating">
                                    <span class="star counted-stars text-primary">★★★★</span>
                                </div>
                                <div class="graph-box">
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                                <div class="percentage text-warning">100%</div>
                            </div>
                            <div class="rating-score">
                                <div class="satisfied-level">
                                    만족해요&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                </div>
                                <div class="star-level">
                                    <label class="star counted-stars text-primary">★★★</label>
                                    <label class="star non-count-star">★</label>
                                </div>
                                <div class="graph-box">
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" style="width: 75%" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                                <div class="percentage text-warning">75%</div>
                            </div>
                            <div class="rating-score">
                                <div class="satisfied-level">
                                    아쉬워요&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                </div>
                                <div class="star-level">
                                    <label class="star counted-stars text-primary">★★</label>
                                    <label class="star non-count-star">★★</label>
                                </div>
                                <div class="graph-box">
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" style="width: 50%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                                <div class="percentage text-warning">50%</div>
                            </div>
                            <div class="rating-score">
                                <div class="satisfied-level">매우 아쉬워요</div>
                                <div class="star-level">
                                    <label class="star counted-stars text-primary">★</label>
                                    <label class="star non-count-star">★★★</label>
                                </div>
                                <div class="graph-box">
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                                <div class="percentage text-warning">25%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="review-header">
                    <div class="event-label outline-primary text-primary">EVENT</div>
                    <div class="review-event-text text-secondary">
                        사진 첨부 후기 작성 시 2,000원의 적립금을 드립니다.(직접 촬영한 사진 필수)
                    </div>
                    <div></div>
                </div>

                <div id="review-wrapper">
                    <div id="cards-wrapper">
                        <div id="review-container">
                            <div class="review-cards">
                                <div class="review-header" style="justify-content: space-between; display: flex">
                                    <span>회원명</span><span>10일전</span>
                                </div>
                                <div class="order-item-detail" style="display: flex">
                                    <div class="item-img">
                                        <!-- <img
                                          src="https://mynameiskuun-img-bucket.s3.ap-northeast-2.amazonaws.com/item/images/1_251007149821208.jpg"
                                        /> -->
                                    </div>
                                    <div class="item-name">스파오 파자마</div>
                                </div>
                                <div class="customer-star-rating-box">
                                    <span class="star counted-stars text-primary">★★★★</span>
                                </div>
                                <div class="review-text">
                                    Lorem, ipsum dolor sit amet consectetur adipisicing elit. Neque
                                    repellat minima, doloribus officia quidem tempore ratione,
                                    maxime velit ut, ipsa voluptatum molestiae consequuntur tempora?
                                    Sit a beatae accusamus iste facere.
                                </div>
                                <div>
                                    <div class="review-item-features text-secondary" style="
                    border: 1px solid;
                    border-radius: 10px;
                    width: 130px;
                    text-align: center;
                  ">
                                        <span class="feature-title">사이즈</span>
                                        <span class="feature-evaluate text-dark" style="font-weight: 500">보통이에요</span>
                                    </div>
                                    <div class="customer-review-img-box"></div>
                                    <div class="review-like-box">
                                        <div class="review-thumbs-up"></div>
                                        <div class="like-title">도움돼요</div>
                                        <div class="like-counts">2</div>
                                    </div>
                                    <div class="review-reply-box">
                                        <div class="review-reply-header">
                                            <span>댓글&nbsp;</span>
                                            <span class="reply-counts text-secondary">2</span>
                                            <span class="text-secondary">개</span>
                                        </div>
                                        <div id="reply-input-container">
                                            <div id="reply-input-box">
                                                <textarea type="textarea" class="form-control" id="reply-input-area" onfocus="replyAreaToggle()"></textarea>
                                                <input type="button" class="btn btn-outline-secondary" value="작성"/>
                                            </div>
                                        </div>
                                        <div class="reply-output-container">
                                            <div class="reply-cards">
                                                <div class="customer-profile-img-box"></div>
                                                <div class="reply-center-box">
                                                    <div class="reply-writer-id">id</div>
                                                    <div class="reply-context-box">
                                                        댓글내용 Lorem ipsum dolor sit amet consectetur adipisicing elit. Nece
                                                    </div>
                                                </div>
                                                <div class="reply-like-box">
                                                    <div class="reply-thumbs-up"></div>
                                                    <div class="reply-like-counts">2</div>
                                                </div>
                                            </div>
                                            <div class="reply-cards">
                                                <div class="customer-profile-img-box"></div>
                                                <div class="reply-center-box">
                                                    <div class="reply-writer-id">id2</div>
                                                    <div class="reply-context-box">
                                                        댓글내용 Lorem ipsum dolor sit amet consectetur adi
                                                    </div>
                                                </div>
                                                <div class="reply-like-box">
                                                    <div class="reply-thumbs-up"></div>
                                                    <div class="reply-like-counts">2</div>
                                                </div>
                                            </div>
                                            <div class="reply-cards">
                                                <div class="customer-profile-img-box"></div>
                                                <div class="reply-center-box">
                                                    <div class="reply-writer-id">작성자 아이디</div>
                                                    <div class="reply-context-box">댓글3</div>
                                                </div>
                                                <div class="reply-like-box">
                                                    <div class="reply-thumbs-up"></div>
                                                    <div class="reply-like-counts">2</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="item-qna-box">
            문의란
            <span>
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Fuga maiores, quis minima incidunt voluptatibus error consectetur et reprehenderit. Repellendus laudantium voluptates ad doloremque neque dolore error dolorum soluta temporibus suscipit.
            </span>
            <!-- 문의란. 게시판 형식으로 페이징 처리 -->
            <!-- ajax 비동기 렌더링 -->
            <!-- 11번가 참고 -->
        </div>
        <!--   footer start   -->
        <th:block th:replace="/main/footer :: footer"></th:block>
        <!--   footer end   -->
    </div>


    <!--  modal start  -->
        <div class="modal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Modal title</h5>
                        <button type="button" class="btn-close"
                                data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p id="cartText">장바구니에 추가 되었습니다.</p>
                        <div class="form-group">
                            <div class="starrr"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary"
                                data-bs-dismiss="modal">쇼핑 계속하기</button>
                        <button type="button"
                                class="btn-primary tocart-btn">장바구니로</button>
                    </div>
                </div>
            </div>
        </div>
    <!--  modal end  -->

    <!-- Bootstrap core JS-->
    <!--  모달 사용을 위해  -->
    <script src="/js/itemdetail.js"></script>
<!--</div>-->

<script th:inline="javascript">
    /* 구매수량 변화 감지, 남은 재고수량 이상으로 장바구니 혹은 결제 안되게 뷰단에서 처리 */
    // 페이지에 나와있는 상품 재고 초과하여 카운트 up 시 alert 출력
    $(".countBox").on('propertychange change keyup paste input', function() {
        let currentVal = $('#orderQuantity').val();
        let stock = [[${item.itemStock}]];
        console.log(currentVal);
        if(currentVal > stock) {
            alert('주문 가능한 수량을 초과 하였습니다.');
            $('#orderQuantity').val(stock);
        }
        if(stock === 0) {
            alert(`품절된 상품입니다`);
        }
    });

    // 장바구니 추가 버튼 메소드
    function cartBtn() {

        if([[${session.loginMember}]] == null) {
            alert('로그인을 해주세요')
            location.href='/login';
        }

        let cartItem = {
            itemDto : [[${item}]],
            quantity : document.getElementById('orderQuantity').value
        };

        // let itemVo = [[${item}]];
        // let quantity = document.getElementById('orderQuantity').value;

        // 뷰단에서 상품 재고 이상으로 주문 안되게 처리

        $.ajax({
            url: '/cart',
            type: 'POST',
            // async: false,
            // async : false의 경우 동기식으로 작동.
            data: JSON.stringify(cartItem),
            contentType: 'application/json; charset=UTF-8',
            dataType: 'text',
            success: function(result) {
                document.getElementById("cartText").innerText = result;
                const modal = new bootstrap.Modal(document.querySelector('.modal'));
                modal.show();
            }
        })
    }

    // 개별상품 주문 이벤트 메소드
    $('#orderBtn').click(function () {

        if([[${session.loginMember}]] == null) {
            alert('로그인을 해주세요')
            location.href = '/login';
        } else {
            let orderQuantity = $('#orderQuantity').val();
            let itemDto = [[${item}]];

            localStorage.setItem("itemDto", JSON.stringify(itemDto));
            localStorage.setItem("orderQuantity", orderQuantity);
            localStorage.setItem('itemImg', imgList[0].modImgName);

            location.href='/detail/order/' + itemDto.getItemId();
        }
    })

    // 모달창 장바구니 버튼 이벤트 메소드
    $('.tocart-btn').click(function() {
        location.href='/cart';
    })


    $("#reply-input-container").on("focus", function () {
        $("#reply-input-area").css("height", "100px");
    });
</script>
</body>
</html>